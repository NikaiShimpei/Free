<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- タイトルも編集可能にするためIDを付与 -->
    <title id="page-title">人の成長戦略会議 #2 課題マップ (新データ版)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Mplus 1p -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mplus+1p:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* Mplus 1p フォントを適用 */
        body {
            font-family: 'Mplus 1p', sans-serif;
            background-color: #000; /* 全体のデフォルト背景を黒に */
            color: #e0e0e0; /* 基本の文字色を明るめに */
        }

        /* 背景グラデーション (body::before) */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* コンテンツの下に配置 */
            opacity: 0.9; /* 少し透明度を持たせて深みを出す */
            /* 複数のグラデーションを重ね合わせ */
            background: 
                radial-gradient(at 0% 0%, #3a0050 0%, transparent 70%),
                radial-gradient(at 100% 0%, #0a012e 0%, transparent 70%),
                radial-gradient(at 0% 100%, #8b0000 0%, transparent 70%),
                radial-gradient(at 100% 100%, #0d015c 0%, transparent 70%),
                radial-gradient(at 50% 50%, #4a0050 0%, transparent 70%);
            background-blend-mode: screen; /* グラデーションの混合モード */
            filter: blur(80px); /* ぼかし効果でなめらかに */
            animation: backgroundShift 30s ease-in-out infinite alternate; /* 背景アニメーション */
        }

        /* 軸ラベルの縦書き */
        .writing-mode-vertical-rl {
            writing-mode: vertical-rl;
            text-orientation: upright; /* 文字を正立させる */
        }

        /* ツールチップのアニメーション */
        .group:hover .tooltip {
            visibility: visible;
            opacity: 1;
            transform: translate(-50%, -10px); /* 少し上に移動するアニメーション */
        }
        .tooltip {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            z-index: 100; /* 最前面に表示 */
        }

        /* カスタムスクロールバー */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* アニメーションキーフレーム */
        @keyframes backgroundShift {
            0% {
                transform: scale(1);
                background-position: 0% 0%, 100% 0%, 0% 100%, 100% 100%, 50% 50%;
            }
            100% {
                transform: scale(1.1);
                background-position: 10% 5%, 90% 5%, 5% 95%, 95% 90%, 45% 55%;
            }
        }
        @keyframes fade-in-down {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slide-in-left {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slide-in-right {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slide-in-top {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slide-in-bottom {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pop-in {
            0% { opacity: 0; transform: scale(0.8); }
            80% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes pulse-light {
            0% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
            100% { filter: brightness(1); }
        }

        /* アニメーションユーティリティクラス */
        .animate-fade-in-down { animation: fade-in-down 0.8s ease-out forwards; }
        .animate-fade-in-up { animation: fade-in-up 0.8s ease-out 0.2s forwards; opacity: 0; }
        .animate-fade-in { animation: fade-in 1s ease-out 0.5s forwards; opacity: 0; }
        .animate-fade-in-delay { animation: fade-in 1s ease-out 0.8s forwards; opacity: 0; }
        .animate-slide-in-left { animation: slide-in-left 0.8s ease-out 1s forwards; opacity: 0; }
        .animate-slide-in-right { animation: slide-in-right 0.8s ease-out 1.1s forwards; opacity: 0; }
        .animate-slide-in-top { animation: slide-in-top 0.8s ease-out 1.2s forwards; opacity: 0; }
        .animate-slide-in-bottom { animation: slide-in-bottom 0.8s ease-out 1.3s forwards; opacity: 0; }
        .animate-pop-in { animation: pop-in 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; opacity: 0; }
        .animate-pulse-light { animation: pulse-light 3s infinite ease-in-out; }

        /* 軸線の光る効果 */
        .shadow-glow {
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.7); /* purple-500 */
        }
        
        /* 編集モード用のスタイル */
        [contenteditable="true"] {
            outline: 2px dashed rgba(255, 255, 255, 0.5);
            outline-offset: 4px;
            background-color: rgba(255, 255, 255, 0.1);
            cursor: text;
        }
        
        /* 編集ボタンのスタイル */
        #edit-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 12px;
        }
        #edit-controls button {
            background-color: rgba(255, 255, 255, 0.9);
            color: #000;
            font-family: 'Mplus 1p', sans-serif;
            font-weight: 700;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease-in-out;
        }
        #edit-controls button:hover {
            background-color: #fff;
            transform: translateY(-2px);
        }
        #edit-controls #save-button,
        #edit-controls #cancel-button {
            display: none; /* 初期状態では非表示 */
        }
    </style>
</head>
<body class="antialiased text-gray-200 relative overflow-x-hidden">

    <!-- 1. タイトルセクション -->
    <section class="relative py-16 md:py-24 z-10">
        <div class="container mx-auto px-4 text-center">
            <!-- 編集可能要素にIDと data-editable を追加 -->
            <h1 id="main-title" data-editable="true" class="text-5xl md:text-7xl font-bold mb-4 text-white drop-shadow-lg animate-fade-in-down">
                人の成長戦略会議 #2
            </h1>
            <p id="sub-title" data-editable="true" class="text-2xl md:text-3xl opacity-80 text-gray-300 drop-shadow animate-fade-in-up">
                全社横断 課題クラスターマップ (2025年度)
            </p>
        </div>
        <!-- 装飾 (光る線) -->
        <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-purple-500 to-transparent animate-pulse-light"></div>
    </section>

    <!-- 2. 4象限バブルチャートセクション -->
    <section class="container mx-auto px-4 py-16 relative z-10">
        <h2 id="quadrant-title" data-editable="true" class="text-4xl font-bold text-center mb-4 text-white drop-shadow-md animate-fade-in">
            4象限 課題クラスターマップ
        </h2>
        <!-- 軸ラベルを H2 の直下に移動し、センタリングを合わせる -->
        <div id="axis-y-top" data-editable="true" class="text-2xl font-bold text-gray-300 whitespace-nowrap animate-fade-in-up text-center mb-12" style="animation-delay: 0.2s;">マネジメント層の課題</div>

        <!-- PC用コンテナ -->
        <div class="hidden md:block max-w-7xl mx-auto relative p-8 bg-black bg-opacity-30 backdrop-blur-sm rounded-3xl shadow-2xl border border-gray-700/50 animate-fade-in-delay">
            
            <!-- 軸ラベル (axis-y-top はH2の下に移動) -->
            <div id="axis-y-bottom" data-editable="true" class="absolute bottom-0 left-1/2 -translate-x-1/2 -mb-12 text-2xl font-bold text-gray-400 whitespace-nowrap animate-slide-in-bottom">現場層の課題</div>
            <div id="axis-x-left" data-editable="true" class="absolute top-1/2 left-0 -translate-y-1/2 -ml-16 text-2xl font-bold text-gray-400 writing-mode-vertical-rl rotate-180 whitespace-nowrap animate-slide-in-left">メンタル・士気</div>
            <div id="axis-x-right" data-editable="true" class="absolute top-1/2 right-0 -translate-y-1/2 -mr-16 text-2xl font-bold text-gray-400 writing-mode-vertical-rl whitespace-nowrap animate-slide-in-right">スキル・成長</div>
            
            <!-- 軸線 (光る) -->
            <div class="absolute top-0 bottom-0 left-1/2 -translate-x-1/2 w-0.5 bg-gradient-to-b from-transparent via-purple-500 to-transparent shadow-glow z-0"></div>
            <div class="absolute left-0 right-0 top-1/2 -translate-y-1/2 h-0.5 bg-gradient-to-r from-transparent via-purple-500 to-transparent shadow-glow z-0"></div>

            <!-- 4象限グリッド (overflow-hidden を削除) -->
            <div class="relative grid grid-cols-2 grid-rows-2 rounded-2xl z-10 border border-gray-700/30">
                
                <!-- 象限③ (左上) -->
                <div id="quadrant-3" class="bg-gradient-to-br from-[#1A203F] to-[#0A102F] p-6 min-h-[400px] flex flex-wrap gap-6 items-center justify-center content-center border-r border-b border-gray-700/30">
                    <!-- JSでバブルを挿入 -->
                </div>
                
                <!-- 象限① (右上) -->
                <div id="quadrant-1" class="bg-gradient-to-bl from-[#1A3F20] to-[#0A2F10] p-6 min-h-[400px] flex flex-wrap gap-6 items-center justify-center content-center border-l border-b border-gray-700/30">
                    <!-- JSでバブルを挿入 -->
                </div>

                <!-- 象限④ (左下) -->
                <div id="quadrant-4" class="bg-gradient-to-tr from-[#3F1A20] to-[#2F0A10] p-6 min-h-[400px] flex flex-wrap gap-6 items-center justify-center content-center border-r border-t border-gray-700/30">
                    <!-- JSでバブルを挿入 -->
                </div>
                
                <!-- 象限② (右下) -->
                <div id="quadrant-2" class="bg-gradient-to-tl from-[#3F3A1A] to-[#2F2A0A] p-6 min-h-[400px] flex flex-wrap gap-6 items-center justify-center content-center border-l border-t border-gray-700/30">
                    <!-- JSでバブルを挿入 -->
                </div>
            </div>
        </div>

        <!-- スマホ用コンテナ -->
        <div class="md:hidden space-y-8 animate-fade-in-delay">
            <!-- 象限③ -->
            <div class="p-4 bg-black bg-opacity-30 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-700/50">
                <h3 id="mobile-q3-title" data-editable="true" class="font-bold text-xl text-center mb-4 p-2 bg-gradient-to-r from-blue-700 to-blue-900 text-white rounded-lg shadow-md animate-pulse-light">③ マネ×メンタル</h3>
                <div id="quadrant-3-mobile" class="bg-gradient-to-br from-[#1A203F] to-[#0A102F] p-4 min-h-[250px] flex flex-wrap gap-4 items-center justify-center content-center rounded-lg border border-gray-700/30"></div>
            </div>
            <!-- 象限① -->
            <div class="p-4 bg-black bg-opacity-30 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-700/50">
                <h3 id="mobile-q1-title" data-editable="true" class="font-bold text-xl text-center mb-4 p-2 bg-gradient-to-r from-green-700 to-green-900 text-white rounded-lg shadow-md animate-pulse-light">① マネ×スキル</h3>
                <div id="quadrant-1-mobile" class="bg-gradient-to-bl from-[#1A3F20] to-[#0A2F10] p-4 min-h-[250px] flex flex-wrap gap-4 items-center justify-center content-center rounded-lg border border-gray-700/30"></div>
            </div>
            <!-- 象限④ -->
            <div class="p-4 bg-black bg-opacity-30 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-700/50">
                <h3 id="mobile-q4-title" data-editable="true" class="font-bold text-xl text-center mb-4 p-2 bg-gradient-to-r from-red-700 to-red-900 text-white rounded-lg shadow-md animate-pulse-light">④ 現場×メンタル</h3>
                <div id="quadrant-4-mobile" class="bg-gradient-to-tr from-[#3F1A20] to-[#2F0A10] p-4 min-h-[250px] flex flex-wrap gap-4 items-center justify-center content-center rounded-lg border border-gray-700/30"></div>
            </div>
            <!-- 象限② -->
            <div class="p-4 bg-black bg-opacity-30 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-700/50">
                <h3 id="mobile-q2-title" data-editable="true" class="font-bold text-xl text-center mb-4 p-2 bg-gradient-to-r from-yellow-700 to-yellow-900 text-white rounded-lg shadow-md animate-pulse-light">② 現場×スキル</h3>
                <div id="quadrant-2-mobile" class="bg-gradient-to-tl from-[#3F3A1A] to-[#2F2A0A] p-4 min-h-[250px] flex flex-wrap gap-4 items-center justify-center content-center rounded-lg border border-gray-700/30"></div>
            </div>
        </div>
    </section>

    <!-- 3. 総括セクション -->
    <section class="relative py-16 z-10">
        <div class="container mx-auto px-4 max-w-4xl p-8 bg-black bg-opacity-30 backdrop-blur-sm rounded-3xl shadow-2xl border border-gray-700/50 animate-fade-in-delay">
            <h2 id="summary-title" data-editable="true" class="text-4xl font-bold text-center mb-10 text-white drop-shadow-md animate-fade-in">
                総括と傾向 (2025年度)
            </h2>
            <div class="space-y-8">
                
                <!-- 総括テキスト 1 -->
                <div class="p-6 border-l-4 border-blue-500 bg-gradient-to-r from-blue-900/40 to-transparent rounded-r-lg shadow-lg hover:shadow-xl transition-shadow duration-300 animate-slide-in-left">
                    <h3 id="summary-1-title" data-editable="true" class="font-bold text-2xl text-blue-300 mb-3">
                        全体の傾向
                    </h3>
                    <ul id="summary-1-list" class="list-disc pl-5 space-y-3 text-gray-300 text-lg">
                        <li id="summary-1-item-1" data-editable="true">
                            多くの局で「キャリアビジョンの欠如」（象限②）が共通課題として挙げられている。特に6局、11局、15局で顕著であり、現場層の成長実感やモチベーションに影響している。
                        </li>
                        <li id="summary-1-item-2" data-editable="true">
                            「繁忙」と「メンタル不調者の個別ケア」（象限④）の必要性は、3局、9局、10局、14局など複数の局で指摘されており、高負荷な業務環境が継続していることが伺える。
                        </li>
                        <li id="summary-1-item-3" data-editable="true">
                            12局や3局では「管理職の負担・孤立」（象限③）が深刻な課題として認識されており、マネジメント層の疲弊が現場のケア不足に直結している構造が懸念される。
                        </li>
                    </ul>
                </div>

                <!-- 総括テキスト 2 -->
                <div class="p-6 border-l-4 border-green-500 bg-gradient-to-r from-green-900/40 to-transparent rounded-r-lg shadow-lg hover:shadow-xl transition-shadow duration-300 animate-slide-in-right">
                    <h3 id="summary-2-title" data-editable="true" class="font-bold text-2xl text-green-300 mb-3">
                        課題の相関
                    </h3>
                    <ul id="summary-2-list" class="list-disc pl-5 space-y-3 text-gray-300 text-lg">
                        <li id="summary-2-item-1" data-editable="true">
                            「リーダー・次世代育成」（象限①）の遅れが、現場層の「キャリアビジョンの欠如」（象限②）や「ロールモデルの不在」に直結している。
                        </li>
                        <li id="summary-2-item-2" data-editable="true">
                            「管理職の負担増大・孤立」（象限③）は、現場の「繁忙」や「メンタル不調」（象限④）への対応を困難にしており、負のスパイラルを生む危険性がある。
                        </li>
                        <li id="summary-2-item-3" data-editable="true">
                            2局や6局で挙がった「女性のキャリア不安」（象限④）は、象限②の「キャリアイメージの欠如」とも関連が深く、ジェンダーの観点を含めた育成パスの整備が求められる。
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- 4. フッターセクション -->
    <footer id="footer-text" data-editable="true" class="text-center py-8 text-gray-500 text-base z-10 relative">
        &copy; 2025 人材開発室
    </footer>

    <!-- 編集コントロールボタン -->
    <div id="edit-controls">
        <button id="edit-button" title="ページを編集する">編集</button>
        <button id="save-button" title="変更を保存する">保存</button>
        <button id="cancel-button" title="編集をキャンセル">キャンセル</button>
        <button id="reset-button" title="保存した内容をリセット">リセット</button>
    </div>


    <!-- C. JavaScriptによる動的生成 -->
    <script>
        // 1. データソース (ilovepdf_merged.pdf から抽出・再構成)
        const clusterData = {
            q1: [ // 象限① (右上: マネ×スキル)
                {
                    name: "リーダー・次世代育成",
                    percentage: 10.0,
                    color: "green",
                    voices: [
                        "一番の課題はリーダークラスの育成。 (2局 植木局長)",
                        "次の部長・TLをどうやって育成していくのか (5局 金野さん)",
                        "管理職になりたいと考える人が減ってしまっている (3局 大村さん)",
                        "特にチームリーダークラス...どうしたらそれがマインドとして出てくるのか (出版局 鏡原局長)",
                        "ユニットの流動性を高めた方がいい (8局 宮本局長)"
                    ]
                },
                {
                    name: "育成の質・方法論",
                    percentage: 8.0,
                    color: "green",
                    voices: [
                        "CSP異動者のトレーナーが中途...「博報堂のBDたるもの」というリードはできない (2局 植木局長)",
                        "伸び悩んでいる⼦に対して、伸びる機会をどう作れるのか (4局 ⽔野補佐)",
                        "アカウント的に重要な業務と、育成ポテンシャルの高い業務を整理 (5局 金野さん)",
                        "業務ができそうな人の仮説を立てて業務付与に臨んでいくやり方 (5局 峯岸さん)"
                    ]
                }
            ],
            q2: [ // 象限② (右下: 現場×スキル)
                {
                    name: "キャリアビジョンの欠如",
                    percentage: 15.0,
                    color: "yellow",
                    voices: [
                        "キャリアに関する満足度が低かった (15局 中島GVM)",
                        "文句は言うものの具体的に何がしたいかのビジョンがない社員 (15局 中野部長)",
                        "キャリアイメージが無いメンバーが多いのはショッキング (6局 片桐補佐)",
                        "憧れの先輩・魅力業務の不足感 (6局 片桐補佐)",
                        "キャリアイメージといっても様々...それぞれの課題あり (6局 新保局長)",
                        "テーマPFの次のキャリアデザインの相談は多い (テーマPF 後藤局長)"
                    ]
                },
                {
                    name: "成長機会・職務のミスマッチ",
                    percentage: 9.0,
                    color: "yellow",
                    voices: [
                        "伸び悩んでいる人に与える職務が11局は少ない (11局 市川局長)",
                        "大きいチームではクライアントを背負うことができずに業務の一端をやるしかない (11局 市川局長)",
                        "BP職として得られるスキルを言語化することで自信が持てる (15局 渡辺部長)",
                        "2配:上司の変化...自分自身の相対的な位置づけがわからなくなってしまっている (3局 峯岸さん)"
                    ]
                }
            ],
            q3: [ // 象限③ (左上: マネ×メンタル)
                {
                    name: "管理職の負担・孤立",
                    percentage: 12.0,
                    color: "blue",
                    voices: [
                        "部署長のメンタリティが心配。 (12局 根岸局長)",
                        "部署長の横連携、コミュニティが減った (孤立化が進んでいる) (12局 根岸局長)",
                        "いまの部署長は...三重苦に苦しんでいて...いちディレクターになっている (12局 永林補佐)",
                        "管理職が背負っている職務が大きすぎる (3局 大村さん)",
                        "新部署長に対するサポート...外村部長、清水部長へのヒアリングを実施 (8局)"
                    ]
                }
            ],
            q4: [ // 象限④ (左下: 現場×メンタル)
                {
                    name: "メンタル不調・個別ケア",
                    percentage: 13.0,
                    color: "red",
                    voices: [
                        "スコアはいいが、会社に来れないひとなど複数いることは事実 (10局 村住局長)",
                        "苦しんでいる人のケアをお願い致します。 (14局 嶋根補佐)",
                        "ここをケアしないと改めて思うことができる (14局 馬殿局長)",
                        "水口さんが気になる、どうすればいいのか (11局 市川局長)",
                        "ティグリスに専任で1人でいっている東はケアしてほしい (14局 荒木補佐)",
                        "岩月をヒアリングしてほしい (14局 渡辺補佐)"
                    ]
                },
                {
                    name: "繁忙・ワークロード",
                    percentage: 10.0,
                    color: "red",
                    voices: [
                        "下期は繁忙が予測される (2局 坂井GVM)",
                        "13-2:さらに下期繁忙になっていく...ケアも大変 (13局 福島さん)",
                        "スズキチームが繁忙の中...部長も含めてケア (9局 富川補佐)",
                        "「忙しさ」の解消はなかなか難しい (4局 坂⼝補佐)",
                        "コンプライアンスの強化で作業が増えている (4局 渡邊GVM)",
                        "「ワークスタイル変革」のところは解決できてない課題 (10局 日野補佐)"
                    ]
                },
                {
                    name: "女性のキャリア不安",
                    percentage: 7.0,
                    color: "red",
                    voices: [
                        "気になっているのは女性のキャリア。 (2局 秋元補佐)",
                        "視野が狭いゆえに、より悩んでいるケースもある (2局 秋元補佐)",
                        "女性のキャリアビジョンへの悩みが増えている (15局 引田補佐)",
                        "女性のキャリアプロジェクト、第2回ワークショップの実施 (9局)"
                    ]
                },
                {
                    name: "将来性・不公平感",
                    percentage: 6.0,
                    color: "red",
                    voices: [
                        "斜陽産業としての不安があるのは仕方ない (15局 引田補佐)",
                        "心理的安全性面はタイトとなっている (3局 御園さん)",
                        "WLBの話や他BD局の隣の芝生が青く見える話も多い (3局 大村さん)",
                        "不公平感について...メッセージングで改善できる部分も (3局 荒川さん)"
                    ]
                }
            ]
        };

        // 2. バブルの生成ロジック

        // バブルのサイズを決定する (Tailwindクラス)
        function getBubbleSize(percentage) {
            if (percentage < 8) return 'w-24 h-24 md:w-32 md:h-32';
            if (percentage < 11) return 'w-28 h-28 md:w-40 md:h-40';
            if (percentage < 14) return 'w-32 h-32 md:w-48 md:h-48';
            return 'w-36 h-36 md:w-56 md:h-56'; // 14以上
        }

        // バブルの色を決定する (Tailwindクラス)
        function getBubbleColors(color) {
            switch (color) {
                case 'green':
                    return 'bg-gradient-to-br from-green-600 to-green-800 text-green-100 border-2 border-green-400/50 hover:from-green-500 hover:to-green-700';
                case 'yellow':
                    return 'bg-gradient-to-br from-yellow-600 to-yellow-800 text-yellow-100 border-2 border-yellow-400/50 hover:from-yellow-500 hover:to-yellow-700';
                case 'blue':
                    return 'bg-gradient-to-br from-blue-600 to-blue-800 text-blue-100 border-2 border-blue-400/50 hover:from-blue-500 hover:to-blue-700';
                case 'red':
                    return 'bg-gradient-to-br from-red-600 to-red-800 text-red-100 border-2 border-red-400/50 hover:from-red-500 hover:to-red-700';
                default:
                    return 'bg-gradient-to-br from-gray-600 to-gray-800 text-gray-100 border-2 border-gray-400/50 hover:from-gray-500 hover:to-gray-700';
            }
        }

        // 「生の声」から発言者情報をパースする
        function parseVoice(voice) {
            const match = voice.match(/^(.*?)(\(.*\))$/);
            if (match) {
                return { text: match[1].trim(), speaker: match[2] };
            }
            return { text: voice, speaker: null };
        }

        // バブルとツールチップを生成する関数
        function createBubbleHTML(cluster) {
            const sizeClass = getBubbleSize(cluster.percentage);
            const colorClasses = getBubbleColors(cluster.color);

            // ツールチップ内の「生の声」リストを生成
            let voicesHTML = cluster.voices.map(voice => {
                const { text, speaker } = parseVoice(voice);
                let speakerHTML = speaker 
                    ? `<span class="block text-gray-400 text-xs italic mt-1">${speaker}</span>` 
                    : '';
                return `<li class="break-words">${text}${speakerHTML}</li>`;
            }).join('');

            return `
                <div class="relative group z-20 animate-pop-in">
                    
                    <!-- バブル本体 -->
                    <div class="${sizeClass} ${colorClasses} rounded-full flex items-center justify-center text-center p-3 cursor-pointer shadow-lg transition-all duration-300 hover:scale-110 hover:shadow-2xl ring-2 ring-transparent group-hover:ring-offset-2 group-hover:ring-offset-black group-hover:ring-white/50">
                        <span class="text-sm md:text-base font-bold leading-tight drop-shadow-md">
                            ${cluster.name}
                            <br>
                            (${cluster.percentage.toFixed(1)}%)
                        </span>
                    </div>
                    
                    <!-- ツールチップ (max-h-* と overflow-y-auto を削除) -->
                    <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-3 w-72 md:w-96 bg-gray-900 bg-opacity-95 text-white text-sm rounded-lg shadow-xl p-4 z-50 invisible opacity-0 tooltip">
                        <ul class="list-disc pl-4 space-y-2">
                            ${voicesHTML}
                        </ul>
                        <!-- ツールチップの矢印 -->
                        <div class="absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-x-8 border-x-transparent border-t-8 border-t-gray-900/95"></div>
                    </div>
                </div>
            `;
        }

        // 3. 描画ロジック (バブル生成)
        document.addEventListener('DOMContentLoaded', () => {
            const containers = {
                'quadrant-1': document.getElementById('quadrant-1'),
                'quadrant-2': document.getElementById('quadrant-2'),
                'quadrant-3': document.getElementById('quadrant-3'),
                'quadrant-4': document.getElementById('quadrant-4'),
                'quadrant-1-mobile': document.getElementById('quadrant-1-mobile'),
                'quadrant-2-mobile': document.getElementById('quadrant-2-mobile'),
                'quadrant-3-mobile': document.getElementById('quadrant-3-mobile'),
                'quadrant-4-mobile': document.getElementById('quadrant-4-mobile'),
            };

            let html_q1 = clusterData.q1.map(createBubbleHTML).join('');
            let html_q2 = clusterData.q2.map(createBubbleHTML).join('');
            let html_q3 = clusterData.q3.map(createBubbleHTML).join('');
            let html_q4 = clusterData.q4.map(createBubbleHTML).join('');

            // PC用コンテナに挿入
            if(containers['quadrant-1']) containers['quadrant-1'].innerHTML = html_q1;
            if(containers['quadrant-2']) containers['quadrant-2'].innerHTML = html_q2;
            if(containers['quadrant-3']) containers['quadrant-3'].innerHTML = html_q3;
            if(containers['quadrant-4']) containers['quadrant-4'].innerHTML = html_q4;

            // モバイル用コンテナに挿入 (複製)
            if(containers['quadrant-1-mobile']) containers['quadrant-1-mobile'].innerHTML = html_q1;
            if(containers['quadrant-2-mobile']) containers['quadrant-2-mobile'].innerHTML = html_q2;
            if(containers['quadrant-3-mobile']) containers['quadrant-3-mobile'].innerHTML = html_q3;
            if(containers['quadrant-4-mobile']) containers['quadrant-4-mobile'].innerHTML = html_q4;
        });

        // 4. 編集機能とLocalStorageのロジック
        document.addEventListener('DOMContentLoaded', () => {
            const editButton = document.getElementById('edit-button');
            const saveButton = document.getElementById('save-button');
            const cancelButton = document.getElementById('cancel-button');
            const resetButton = document.getElementById('reset-button');
            const editableElements = document.querySelectorAll('[data-editable="true"]');
            
            // ページのユニークなキー（ファイル名に基づく）
            const storageKey = 'editableContent_kadai_map_new_data';
            let originalContent = {}; // キャンセル用に元の内容を保持

            // 1. 読み込み: localStorageからデータをロードする
            function loadContent() {
                try {
                    const savedContent = localStorage.getItem(storageKey);
                    if (savedContent) {
                        const content = JSON.parse(savedContent);
                        Object.keys(content).forEach(id => {
                            const element = document.getElementById(id);
                            if (element) {
                                if (id === 'page-title') {
                                    document.title = content[id];
                                } else {
                                    element.innerHTML = content[id];
                                }
                            }
                        });
                    }
                } catch (e) {
                    console.error("保存されたコンテンツの読み込みに失敗しました。", e);
                    localStorage.removeItem(storageKey); // 壊れたデータを削除
                }
            }

            // 2. 編集モード開始
            function startEditing() {
                // キャンセル用に現在の内容を保存
                originalContent = {};
                editableElements.forEach(el => {
                    originalContent[el.id] = el.innerHTML;
                    el.setAttribute('contenteditable', 'true');
                });
                
                // ページタイトルも編集対象に含める（ただし表示は変えない）
                originalContent['page-title'] = document.title;
                
                editButton.style.display = 'none';
                resetButton.style.display = 'none';
                saveButton.style.display = 'inline-block';
                cancelButton.style.display = 'inline-block';
            }

            // 3. 保存
            function saveContent() {
                let contentToSave = {};
                editableElements.forEach(el => {
                    contentToSave[el.id] = el.innerHTML;
                    el.setAttribute('contenteditable', 'false');
                });
                
                // ページタイトルを個別に保存
                const newTitle = prompt("新しいページタイトルを入力してください:", document.title);
                if (newTitle !== null && newTitle.trim() !== "") {
                    document.title = newTitle;
                    contentToSave['page-title'] = newTitle;
                } else if (newTitle === null) {
                    // キャンセルされた場合は元のタイトルを保存
                    contentToSave['page-title'] = document.title;
                } else {
                    // 空文字の場合は元のタイトルを保存
                    contentToSave['page-title'] = document.title;
                }


                try {
                    localStorage.setItem(storageKey, JSON.stringify(contentToSave));
                    alert("保存しました。");
                } catch (e) {
                    console.error("コンテンツの保存に失敗しました。", e);
                    alert("エラーが発生し、保存できませんでした。");
                }
                
                endEditing();
            }

            // 4. キャンセル
            function cancelEditing() {
                editableElements.forEach(el => {
                    if (originalContent[el.id]) {
                        el.innerHTML = originalContent[el.id];
                    }
                    el.setAttribute('contenteditable', 'false');
                });
                
                // ページタイトルを元に戻す
                if (originalContent['page-title']) {
                    document.title = originalContent['page-title'];
                }
                
                endEditing();
            }

            // 5. 編集モード終了（共通処理）
            function endEditing() {
                editableElements.forEach(el => {
                    el.setAttribute('contenteditable', 'false');
                });
                
                editButton.style.display = 'inline-block';
                resetButton.style.display = 'inline-block';
                saveButton.style.display = 'none';
                cancelButton.style.display = 'none';
            }
            
            // 6. リセット
            function resetContent() {
                if (confirm("保存した内容をすべてリセットし、ページをリロードしますか？\n（元のHTMLの初期状態に戻ります）")) {
                    localStorage.removeItem(storageKey);
                    location.reload();
                }
            }

            // イベントリスナーの設定
            editButton.addEventListener('click', startEditing);
            saveButton.addEventListener('click', saveContent);
            cancelButton.addEventListener('click', cancelEditing);
            resetButton.addEventListener('click', resetContent);

            // ページ読み込み時に保存された内容をロード
            loadContent();
        });

    </script>

</body>
</html>


