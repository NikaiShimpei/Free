<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">人の成長戦略会議 D2 課題マップ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Mplus 1p) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- 基本フォント設定 --- */
        body {
            font-family: 'M PLUS 1p', sans-serif;
            background-color: #000;
            color: #E5E7EB; /* text-gray-200 */
        }

        /* --- オーロラ背景 --- */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100vh;
            z-index: -1;
            background: 
                radial-gradient(at 0% 0%, #3a0050 0%, transparent 70%),
                radial-gradient(at 100% 0%, #0a012e 0%, transparent 70%),
                radial-gradient(at 0% 100%, #8b0000 0%, transparent 70%),
                radial-gradient(at 100% 100%, #0d015c 0%, transparent 70%),
                radial-gradient(at 50% 50%, #4a0050 0%, transparent 70%);
            background-blend-mode: screen;
            filter: blur(80px);
            animation: backgroundShift 30s ease-in-out infinite alternate;
            will-change: transform, background-position;
        }

        /* --- カスタムスクロールバー --- */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: rgba(168, 85, 247, 0.5); /* purple-500 */
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: content-box;
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: rgba(168, 85, 247, 0.8);
        }

        /* --- ユーティリティクラス --- */
        .shadow-glow {
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.7); /* purple-500 */
        }
        .writing-mode-vertical-rl {
            writing-mode: vertical-rl;
        }

        /* --- ツールチップ アニメーション --- */
        .group .tooltip {
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            transform: translate(-50%, 0);
            z-index: 100; /* ツールチップが最前面に */
        }
        .group:hover .tooltip {
            transform: translate(-50%, -10px);
        }

        /* --- 編集機能スタイル --- */
        [contenteditable="true"] {
            outline: 2px dashed rgba(255, 255, 255, 0.5);
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            cursor: text;
        }
        #edit-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 8px;
        }
        #edit-controls button {
            background-color: rgba(255, 255, 255, 0.9);
            color: #333;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }
        #edit-controls button:hover {
            background-color: #fff;
            transform: translateY(-2px);
        }
        #edit-controls #save-button,
        #edit-controls #cancel-button {
            display: none;
        }
        #edit-controls #save-button {
            background-color: #4CAF50; /* Green */
            color: white;
        }
        #edit-controls #save-button:hover {
            background-color: #45a049;
        }
        #edit-controls #reset-button {
            background-color: #f44336; /* Red */
            color: white;
        }
        #edit-controls #reset-button:hover {
            background-color: #d32f2f;
        }


        /* --- アニメーションキーフレーム --- */
        @keyframes backgroundShift {
            0% {
                transform: scale(1);
                background-position: 0% 0%, 100% 0%, 0% 100%, 100% 100%, 50% 50%;
            }
            100% {
                transform: scale(1.1);
                background-position: 10% 5%, 90% 5%, 5% 95%, 95% 90%, 45% 55%;
            }
        }
        
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in { animation: fade-in 1s ease-out forwards; }
        .animate-fade-in-delay { animation: fade-in 1s ease-out 0.8s forwards; opacity: 0; }

        @keyframes fade-in-down {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-down { animation: fade-in-down 0.8s ease-out forwards; }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fade-in-up 0.8s ease-out 0.2s forwards; opacity: 0; }
        
        @keyframes slide-in-left {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .animate-slide-in-left { animation: slide-in-left 1s ease-out 0.5s forwards; opacity: 0; }

        @keyframes slide-in-right {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .animate-slide-in-right { animation: slide-in-right 1s ease-out 0.5s forwards; opacity: 0; }

        @keyframes slide-in-top {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in-top { animation: slide-in-top 1s ease-out 0.5s forwards; opacity: 0; }

        @keyframes slide-in-bottom {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in-bottom { animation: slide-in-bottom 1s ease-out 0.5s forwards; opacity: 0; }

        @keyframes pop-in {
            0% { opacity: 0; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1); }
        }
        .animate-pop-in {
            opacity: 0;
            animation: pop-in 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
        }
        
        @keyframes pulse-light {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        .animate-pulse-light {
            animation: pulse-light 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="overflow-x-hidden antialiased">

    <!-- 1. タイトルセクション -->
    <section class="relative py-16 md:py-24 text-center overflow-hidden">
        <div class="relative z-10">
            <h1 id="main-title" data-editable="true" class="text-5xl md:text-7xl font-bold text-white drop-shadow-lg animate-fade-in-down">
                人の成長戦略会議
            </h1>
            <p id="sub-title" data-editable="true" class="text-2xl md:text-3xl text-gray-300 opacity-80 mt-4 drop-shadow animate-fade-in-up">
                D2 課題マップ
            </p>
        </div>
        <!-- 装飾ライン -->
        <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-1/3 md:w-1/4 h-1 bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500 animate-pulse-light rounded-full"></div>
    </section>

    <!-- 2. 4象限バブルチャートセクション -->
    <section class="container mx-auto px-4 py-16 md:py-24">
        <h2 id="quadrant-title" data-editable="true" class="text-4xl font-bold text-white text-center mb-4 md:mb-16 animate-fade-in">
            4象限 課題マップ
        </h2>

        <!-- PC用コンテナ (md以上で表示) -->
        <div class="hidden md:block relative bg-black bg-opacity-30 backdrop-blur-sm rounded-3xl shadow-2xl border border-gray-700/50 p-8 md:p-12 animate-fade-in-delay">
            
            <!-- 軸ラベル (PC) -->
            <div id="axis-y-top" data-editable="true" class="text-center mb-12 text-2xl font-bold text-gray-300 animate-slide-in-top">
                マネジメント層の課題
            </div>
            <div id="axis-y-bottom" data-editable="true" class="absolute bottom-0 left-1/2 -translate-x-1/2 -mb-12 text-2xl font-bold text-gray-300 animate-slide-in-bottom">
                現場層の課題
            </div>
            <div id="axis-x-left" data-editable="true" class="absolute top-1/2 left-0 -translate-y-1/2 -ml-16 text-2xl font-bold text-gray-300 writing-mode-vertical-rl rotate-180 animate-slide-in-left">
                メンタル・士気
            </div>
            <div id="axis-x-right" data-editable="true" class="absolute top-1/2 right-0 -translate-y-1/2 -mr-16 text-2xl font-bold text-gray-300 writing-mode-vertical-rl animate-slide-in-right">
                スキル・成長
            </div>

            <!-- 軸線 -->
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-1 bg-gradient-to-r from-purple-600/50 via-purple-400 to-purple-600/50 shadow-glow rounded-full z-0"></div>
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-full w-1 bg-gradient-to-b from-purple-600/50 via-purple-400 to-purple-600/50 shadow-glow rounded-full z-0"></div>

            <!-- 4象限グリッド (PC) -->
            <div class="relative grid grid-cols-2 grid-rows-2 rounded-2xl border border-gray-700/30 z-10">
                <!-- 象限③ (左上) -->
                <div id="quadrant-3" class="relative bg-gradient-to-br from-[#1A203F] to-[#0A102F] rounded-tl-2xl border-r border-b border-gray-700/30 flex flex-wrap gap-5 items-center justify-center content-center p-6 min-h-[400px]">
                    <!-- JSでバブルを挿入 -->
                </div>
                <!-- 象限① (右上) -->
                <div id="quadrant-1" class="relative bg-gradient-to-bl from-[#1A3F20] to-[#0A2F10] rounded-tr-2xl border-l border-b border-gray-700/30 flex flex-wrap gap-5 items-center justify-center content-center p-6 min-h-[400px]">
                    <!-- JSでバブルを挿入 -->
                </div>
                <!-- 象限④ (左下) -->
                <div id="quadrant-4" class="relative bg-gradient-to-tr from-[#3F1A20] to-[#2F0A10] rounded-bl-2xl border-r border-t border-gray-700/30 flex flex-wrap gap-5 items-center justify-center content-center p-6 min-h-[400px]">
                    <!-- JSでバブルを挿入 -->
                </div>
                <!-- 象限② (右下) -->
                <div id="quadrant-2" class="relative bg-gradient-to-tl from-[#3F3A1A] to-[#2F2A0A] rounded-br-2xl border-l border-t border-gray-700/30 flex flex-wrap gap-5 items-center justify-center content-center p-6 min-h-[400px]">
                    <!-- JSでバブルを挿入 -->
                </div>
            </div>
        </div>

        <!-- スマホ用コンテナ (md未満で表示) -->
        <div class="md:hidden space-y-8 animate-fade-in-delay">
            <!-- 象限③ (左上) -->
            <div class="bg-black bg-opacity-30 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-700/50 overflow-hidden">
                <h3 id="mobile-q3-title" data-editable="true" class="text-xl font-bold p-4 bg-gradient-to-r from-blue-700 to-blue-900 animate-pulse-light">
                    ③ マネジメント × メンタル
                </h3>
                <div id="quadrant-3-mobile" class="flex flex-wrap gap-4 items-center justify-center content-center p-4 min-h-[250px] bg-gradient-to-br from-[#1A203F]/50 to-[#0A102F]/50">
                    <!-- JSでバブルを挿入 -->
                </div>
            </div>
            <!-- 象限① (右上) -->
            <div class="bg-black bg-opacity-30 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-700/50 overflow-hidden">
                <h3 id="mobile-q1-title" data-editable="true" class="text-xl font-bold p-4 bg-gradient-to-r from-green-700 to-green-900 animate-pulse-light">
                    ① マネジメント × スキル
                </h3>
                <div id="quadrant-1-mobile" class="flex flex-wrap gap-4 items-center justify-center content-center p-4 min-h-[250px] bg-gradient-to-bl from-[#1A3F20]/50 to-[#0A2F10]/50">
                    <!-- JSでバブルを挿入 -->
                </div>
            </div>
            <!-- 象限④ (左下) -->
            <div class="bg-black bg-opacity-30 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-700/50 overflow-hidden">
                <h3 id="mobile-q4-title" data-editable="true" class="text-xl font-bold p-4 bg-gradient-to-r from-red-700 to-red-900 animate-pulse-light">
                    ④ 現場 × メンタル
                </h3>
                <div id="quadrant-4-mobile" class="flex flex-wrap gap-4 items-center justify-center content-center p-4 min-h-[250px] bg-gradient-to-tr from-[#3F1A20]/50 to-[#2F0A10]/50">
                    <!-- JSでバブルを挿入 -->
                </div>
            </div>
            <!-- 象限② (右下) -->
            <div class="bg-black bg-opacity-30 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-700/50 overflow-hidden">
                <h3 id="mobile-q2-title" data-editable="true" class="text-xl font-bold p-4 bg-gradient-to-r from-yellow-700 to-yellow-900 animate-pulse-light">
                    ② 現場 × スキル
                </h3>
                <div id="quadrant-2-mobile" class="flex flex-wrap gap-4 items-center justify-center content-center p-4 min-h-[250px] bg-gradient-to-tl from-[#3F3A1A]/50 to-[#2F2A0A]/50">
                    <!-- JSでバブルを挿入 -->
                </div>
            </div>
        </div>
    </section>

    <!-- 3. 総括セクション -->
    <section class="relative py-16 md:py-24">
        <div class="container mx-auto px-4">
            <div class="relative bg-black bg-opacity-30 backdrop-blur-sm rounded-3xl shadow-2xl border border-gray-700/50 p-8 md:p-12 animate-fade-in-delay">
                <h2 id="summary-title" data-editable="true" class="text-4xl font-bold text-white text-center mb-10 md:mb-12">
                    総括とネクストステップ
                </h2>
                
                <div class="grid md:grid-cols-3 gap-8 text-gray-300">
                    
                    <!-- 経営・組織課題 -->
                    <div class="animate-slide-in-left" style="animation-delay: 0.8s;">
                        <h3 id="summary-1-title" data-editable="true" class="text-2xl font-bold text-white mb-4">
                            1. 経営・組織課題
                        </h3>
                        <div class="border-l-4 border-red-500 bg-gradient-to-r from-red-900/40 to-transparent p-4 rounded-r-lg">
                            <ul id="summary-1-list" class="list-disc list-inside space-y-2 text-lg">
                                <li id="summary-1-item-1" data-editable="true">HMP統合とPMIの遅れが、現場の「閉塞感」や「将来不安」の最大の要因となっている。</li>
                                <li id="summary-1-item-2" data-editable="true">ミッションの曖昧化と、経営層の方針が現場に伝わっていないことへの不満が強い。</li>
                                <li id="summary-1-item-3" data-editable="true">旧MPの体制・事業への無理解が、現場の負担と士気低下を招いている。</li>
                            </ul>
                        </div>
                    </div>

                    <!-- マネジメント課題 -->
                    <div class="animate-slide-in-left" style="animation-delay: 1.0s;">
                        <h3 id="summary-2-title" data-editable="true" class="text-2xl font-bold text-white mb-4">
                            2. マネジメント課題
                        </h3>
                        <div class="border-l-4 border-blue-500 bg-gradient-to-r from-blue-900/40 to-transparent p-4 rounded-r-lg">
                            <ul id="summary-2-list" class="list-disc list-inside space-y-2 text-lg">
                                <li id="summary-2-item-1" data-editable="true">「エキスパート職」の処遇とモチベーション維持が、複数の局で深刻な課題となっている。</li>
                                <li id="summary-2-item-2" data-editable="true">部長陣のマネジメント（部下の状況把握不足、負荷）に課題感が見られる。</li>
                                <li id="summary-2-item-3" data-editable="true">シニア層のネクストキャリアとモチベーションをどう支援するかが、組織的な課題となっている。</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 現場・育成課題 -->
                    <div class="animate-slide-in-right" style="animation-delay: 1.2s;">
                        <h3 id="summary-3-title" data-editable="true" class="text-2xl font-bold text-white mb-4">
                            3. 現場・育成課題
                        </h3>
                        <div class="border-l-4 border-green-500 bg-gradient-to-r from-green-900/40 to-transparent p-4 rounded-r-lg">
                            <ul id="summary-3-list" class="list-disc list-inside space-y-2 text-lg">
                                <li id="summary-3-item-1" data-editable="true">若手・新人の「孤立感」と「キャリア不安」が顕著。出社率の低さがコミュニケーション不足に拍車。</li>
                                <li id="summary-3-item-2" data-editable="true">「異能人材」の採用・育成・還流が、局の将来にとって最重要課題と認識されている。</li>
                                <li id="summary-3-item-3" data-editable="true">H統合への対応力として、プロ意識を持った「リスキリング（自己学習）」と「社内外交」が急務。</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 4. フッターセクション -->
    <footer class="text-center py-8 text-gray-500 text-base">
        <p id="footer-text" data-editable="true">© 2025 人材開発室. All rights reserved.</p>
    </footer>

    <!-- 5. 編集コントロールUI -->
    <div id="edit-controls">
        <button id="edit-button" title="テキストを編集する">編集</button>
        <button id="save-button" title="変更を保存する">保存</button>
        <button id="cancel-button" title="編集をキャンセルする">キャンセル</button>
        <button id="reset-button" title="保存内容をリセットする">リセット</button>
    </div>


    <script>
        // <C. 新しいデータソース>
        // PDF議事録から抽出・分類したデータ
        const clusterData = {
            // 象限① (右上: マネジメント × スキル)
            q1: [
                { 
                    name: "異能人材の採用・育成", 
                    color: "green", 
                    voices: [ 
                        "AI・クラウドに精通してほしいという要望が来るが、若手だけでは対応できない (長瀬)",
                        "異能人材をどう採用し、どう還流させていくかが局の最重要課題 (長瀬)",
                        "明確な(異能人材の) 採用計画はない (浅田)",
                        "異能人材がメディアとAIの新しいシナジーを生み出す動きは価値が高い (鈴木)"
                    ] 
                },
                { 
                    name: "H統合への対応力", 
                    color: "green", 
                    voices: [
                        "「博報堂という変化」に対応できているかが社員の伸長を分けている (三四郎)",
                        "ベースの知識が不足しており、Hクリとの協業で不利になる可能性 (コンクリ局)",
                        "知識は「自分で学ぶ」必要があり、プロとして自己鍛錬が求められる (コンクリ局)"
                    ] 
                },
                { 
                    name: "職種横断の必要性", 
                    color: "green", 
                    voices: [ 
                        "「やったことがないから分からない」をなくすため、もっと職種を回した方がいい (川上)"
                    ] 
                },
                { 
                    name: "管理職のスキル", 
                    color: "green", 
                    voices: [
                        "部長が苦手な「人に任せること」に焦点を当てた動画コンテンツを公開 (人材開発室)",
                        "中途採用で営業から来たが、かなり苦しんでいる様子 (松本) (梅本)"
                    ]
                },
            ],
            // 象限② (右下: 現場 × スキル)
            q2: [
                { 
                    name: "現場のキャリア不安", 
                    color: "yellow", 
                    voices: [ 
                        "「自分の展望やキャリアイメージが持てるか」で悪化した人が特徴的に多い (AaaS局)",
                        "若手が「キャリアイメージ」に×をつけている (飯塚)",
                        "ロールモデルが見えにくいのではないか (長瀬)",
                        "貢献の手触り感が掴みにくいのではないか (田代)"
                    ] 
                },
                { 
                    name: "フロントライン留学", 
                    color: "yellow", 
                    voices: [ 
                        "三ッ巻、松元のフロントライン留学 (ONE業推へ) は、本人もびっくりしていた (飯塚)",
                        "「AaaSでの経験が営業でこう役立った」を局会で共有し、若手の不安を払拭したい (吉本)"
                    ] 
                },
                { 
                    name: "リスキリングの必要性", 
                    color: "yellow", 
                    voices: [
                        "実践は踏んでいるが、コンテンツビジネスやライツのベース知識が不足 (コンクリ局)",
                        "「リスキリング」を促進する施策を人材開発にて検討 (ネクストアクション)"
                    ]
                },
                {
                    name: "研修・スキル可視化",
                    color: "yellow",
                    voices: [
                        "「課題設定のためのマーケティングフレームの基本」は若手に有用 (人材開発室)",
                        "スキルサーベイを全職種共通の統一調査へ変更 (人材開発室)"
                    ]
                }
            ],
            // 象限③ (左上: マネジメント × メンタル)
            q3: [
                { 
                    name: "エキスパート職の処遇", 
                    color: "blue", 
                    voices: [ 
                        "負荷が上がり続ける中、モチベーションをコントロールするのがしんどい (朝倉部長)",
                        "エキスパートが報われる仕組みは？ (朝倉部長)",
                        "「3年間ステイ」という制度が根本的な問題 (佐藤大)",
                        "給与体系はがんばらなくても上がる仕組み。エキスパートから部長を登用すべき (藤川)",
                        "スキルと自信がつき、市場価値が高まった社員ほど不満を抱き退職する (木村)"
                    ] 
                },
                { 
                    name: "部長陣のマネジメント", 
                    color: "blue", 
                    voices: [ 
                        "森川部長は「窮々」メンバーが5人もいるのに、ケアが語られなかった (恒川)",
                        "部下から「彼(森川部長)に話す気がない」と言っている人が多い (恒川)",
                        "太田部長自身も悩んでおり、溜め込む性格のため解放させる場を作りたい (恒川)"
                    ] 
                },
                { 
                    name: "PMIへの懸念", 
                    color: "blue", 
                    voices: [
                        "経営統合が「どっちつかず」で、しわ寄せが全て現場の負担と士気低下に (OA局)",
                        "ミッションの責任の所在が不明確であることが士気低下の最大要因 (OA局)"
                    ]
                },
                {
                    name: "シニア・出向者の活用",
                    color: "blue",
                    voices: [
                        "ネクストキャリアを考えるシニア層に対する会社の支援のあり方 (グループメディア)",
                        "55過ぎた人に経験を積ませるのは(若手育成とは)違う (林局長)"
                    ]
                }
            ],
            // 象限④ (左下: 現場 × メンタル)
            q4: [
                { 
                    name: "会社の将来性への不安", 
                    color: "red", 
                    voices: [ 
                        "「会社の現状や将来性に不安」が43% (統合AP)",
                        "特に旧MPのメンバーで傾向が顕著 (統合AP)",
                        "関連会社の役員が相次いで退職したことが大きい (藤本)",
                        "競合(CA等)を見て「自社は大丈夫か」と憂慮 (田代)",
                        "メディア事業の先行き不安に起因する閉塞感 (OA局)"
                    ] 
                },
                { 
                    name: "人事・処遇への不公平感", 
                    color: "red", 
                    voices: [ 
                        "「人事や処遇が不公平」が前回0から5人ついた (AaaS局)",
                        "超若手が(冷遇されてないのに)不公平と感じているのがわからない (飯塚)",
                        "給与支給後に不満が出やすい傾向 (グループメディア)"
                    ] 
                },
                { 
                    name: "新人の孤立・疎外感", 
                    color: "red", 
                    voices: [ 
                        "「もっと会社に来たい」「所属意識が持てない」 (新人)",
                        "トレーナーに月2回しか会えない、飲み会が2回しかない (新人)",
                        "出社しても先輩がいないと、かえって寂しさが増す (糸永)"
                    ] 
                },
                { 
                    name: "コミュニケーション不足", 
                    color: "red", 
                    voices: [
                        "「思ったままを話せる」が全社平均を下回る (コンクリ局)",
                        "出社しない社員が多く、席にいないことが主因 (コンクリ局)",
                        "フロアの席不足で偶発的なコミュニケーションが困難 (コンクリ局)"
                    ]
                },
                {
                    name: "業務負荷・上司との関係",
                    color: "red",
                    voices: [
                        "テレアカのメンバーで「忙しい」「追われている」回答が増加 (統合AP)",
                        "「上司との関係」が相対的に悪い傾向 (新聞雑誌局)",
                        "業務の広がりがないことへの不満 (市川)"
                    ]
                }
            ]
        };

        // <C. JavaScriptによる動的生成>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 2. パーセンテージの自動計算ロジック ---
            let totalVoices = 0;
            Object.values(clusterData).forEach(quadrant => {
                quadrant.forEach(cluster => {
                    totalVoices += cluster.voices.length;
                });
            });

            if (totalVoices > 0) {
                Object.values(clusterData).forEach(quadrant => {
                    quadrant.forEach(cluster => {
                        cluster.percentage = (cluster.voices.length / totalVoices) * 100;
                    });
                });
            } else {
                // 0除算を避ける
                Object.values(clusterData).forEach(quadrant => {
                    quadrant.forEach(cluster => {
                        cluster.percentage = 0;
                    });
                });
            }


            // --- 3. バブルの生成 ---

            // パーセンテージに応じてサイズを決定
            function getBubbleSize(percentage) {
                if (percentage >= 15) return 'w-48 h-48 md:w-56 md:h-56'; // 特大
                if (percentage >= 10) return 'w-40 h-40 md:w-48 md:h-48'; // 大
                if (percentage >= 5) return 'w-32 h-32 md:w-40 md:h-40'; // 中
                if (percentage >= 2) return 'w-24 h-24 md:w-32 md:h-32'; // 小
                return 'w-20 h-20 md:w-24 md:h-24'; // 極小
            }

            // 色に応じてグラデーションとボーダーを決定
            function getBubbleColors(color) {
                switch (color) {
                    case 'green':
                        return 'bg-gradient-to-br from-green-600 to-green-800 border-green-400';
                    case 'yellow':
                        return 'bg-gradient-to-br from-yellow-600 to-yellow-800 border-yellow-400';
                    case 'blue':
                        return 'bg-gradient-to-br from-blue-600 to-blue-800 border-blue-400';
                    case 'red':
                        return 'bg-gradient-to-br from-red-600 to-red-800 border-red-400';
                    default:
                        return 'bg-gradient-to-br from-gray-600 to-gray-800 border-gray-400';
                }
            }

            // (発言者) の部分をパースしてスタイルを適用
            function parseVoice(voice) {
                // (発言者) または (局名) または (役職) などを検出
                const regex = /(.*?)(\s?\(.*?\))$/;
                const match = voice.match(regex);
                if (match) {
                    // match[1] = 発言内容, match[2] = (発言者)
                    return `${match[1]}<span class="text-gray-400 text-xs block mt-1">${match[2]}</span>`;
                }
                return voice;
            }

            // バブルのHTMLを生成
            function createBubbleHTML(cluster, index) {
                const sizeClass = getBubbleSize(cluster.percentage);
                const colorClasses = getBubbleColors(cluster.color);
                
                // アニメーション遅延を計算
                const delay = (index * 150) + 'ms';

                // ツールチップ内の「生の声」リストを生成
                const voicesHTML = cluster.voices.map(voice => 
                    `<li class="border-b border-gray-700/50 py-2 last:border-b-0">
                        ${parseVoice(voice)}
                    </li>`
                ).join('');

                return `
                    <div class="group relative ${sizeClass} ${colorClasses}
                                rounded-full border-2 shadow-xl cursor-pointer
                                flex items-center justify-center text-center p-2
                                text-white font-bold transform transition-all duration-300 
                                hover:scale-110 hover:shadow-2xl hover:z-20
                                group-hover:ring-4 group-hover:ring-offset-2 group-hover:ring-offset-black group-hover:ring-white/50
                                animate-pop-in"
                         style="animation-delay: ${delay};">
                        
                        <!-- バブル内のテキスト -->
                        <span class="text-sm md:text-base leading-tight drop-shadow-md">
                            ${cluster.name}
                            <br>
                            (${cluster.percentage.toFixed(1)}%)
                        </span>

                        <!-- ツールチップ -->
                        <div class="tooltip absolute bottom-full left-1/2 mb-2
                                    w-72 md:w-96 
                                    bg-gray-900 bg-opacity-95 backdrop-blur-md 
                                    border border-gray-700/50
                                    text-white text-sm font-normal text-left
                                    rounded-lg shadow-xl p-4
                                    invisible opacity-0 group-hover:visible group-hover:opacity-100">
                            
                            <h4 class="text-base font-bold mb-2 pb-2 border-b border-gray-700 ${colorClasses.replace('bg-gradient-to-br', 'text-transparent bg-clip-text')}">
                                ${cluster.name}
                            </h4>
                            <p class="text-gray-400 mb-3 text-xs">関連する「生の声」:</p>
                            <ul class="space-y-1 list-none p-0 m-0 max-h-64 overflow-y-auto">
                                ${voicesHTML}
                            </ul>
                        </div>
                    </div>
                `;
            }

            // --- 4. 描画ロジック ---
            const quadrants = [
                { id: 'quadrant-1', data: clusterData.q1.sort((a, b) => b.percentage - a.percentage) }, // 右上
                { id: 'quadrant-2', data: clusterData.q2.sort((a, b) => b.percentage - a.percentage) }, // 右下
                { id: 'quadrant-3', data: clusterData.q3.sort((a, b) => b.percentage - a.percentage) }, // 左上
                { id: 'quadrant-4', data: clusterData.q4.sort((a, b) => b.percentage - a.percentage) }, // 左下
            ];

            quadrants.forEach(q => {
                const pcContainer = document.getElementById(q.id);
                const mobileContainer = document.getElementById(`${q.id}-mobile`);
                let htmlContent = '';
                
                q.data.forEach((cluster, index) => {
                    htmlContent += createBubbleHTML(cluster, index);
                });

                if (pcContainer) pcContainer.innerHTML = htmlContent;
                if (mobileContainer) mobileContainer.innerHTML = htmlContent;
            });


            // --- 5. 編集機能とLocalStorageのロジック ---
            const storageKey = 'editableContent_growthMapD2';
            const editableElements = document.querySelectorAll('[data-editable="true"]');
            const editButton = document.getElementById('edit-button');
            const saveButton = document.getElementById('save-button');
            const cancelButton = document.getElementById('cancel-button');
            const resetButton = document.getElementById('reset-button');
            let originalContent = {};

            // localStorageからコンテンツを読み込む
            function loadContent() {
                try {
                    const savedContent = localStorage.getItem(storageKey);
                    if (savedContent) {
                        const content = JSON.parse(savedContent);
                        editableElements.forEach(el => {
                            if (content[el.id]) {
                                if (el.id === 'page-title') {
                                    document.title = content[el.id];
                                } else {
                                    el.innerHTML = content[el.id];
                                }
                            }
                        });
                        if (content['page-title']) {
                            document.title = content['page-title'];
                        }
                    }
                } catch (error) {
                    console.error("Failed to load content from localStorage:", error);
                }
            }

            // 編集モードを終了する（状態をリセット）
            function endEditing() {
                editableElements.forEach(el => {
                    el.contentEditable = 'false';
                    el.blur();
                });
                editButton.style.display = 'inline-block';
                resetButton.style.display = 'inline-block';
                saveButton.style.display = 'none';
                cancelButton.style.display = 'none';
            }

            // 編集モードを開始する
            function startEditing() {
                originalContent = {}; // 元の内容を退避
                editableElements.forEach(el => {
                    originalContent[el.id] = el.innerHTML;
                    el.contentEditable = 'true';
                });
                originalContent['page-title'] = document.title;
                
                editButton.style.display = 'none';
                resetButton.style.display = 'none';
                saveButton.style.display = 'inline-block';
                cancelButton.style.display = 'inline-block';
            }

            // 変更を保存する
            function saveContent() {
                try {
                    // カスタムプロンプトでページタイトルを取得
                    const newPageTitle = prompt("新しいページタイトルを入力してください:", document.title);
                    if (newPageTitle !== null) { // キャンセルでなければ
                        document.title = newPageTitle;
                        
                        const contentToSave = {};
                        editableElements.forEach(el => {
                            contentToSave[el.id] = el.innerHTML;
                        });
                        contentToSave['page-title'] = newPageTitle;

                        localStorage.setItem(storageKey, JSON.stringify(contentToSave));
                        endEditing();
                    }
                } catch (error) {
                    console.error("Failed to save content to localStorage:", error);
                    alert("保存に失敗しました。");
                }
            }

            // 編集をキャンセルする
            function cancelEditing() {
                // 退避した内容を復元
                editableElements.forEach(el => {
                    if (originalContent[el.id]) {
                        if (el.id === 'page-title') {
                             document.title = originalContent[el.id];
                        } else {
                            el.innerHTML = originalContent[el.id];
                        }
                    }
                });
                 if (originalContent['page-title']) {
                    document.title = originalContent['page-title'];
                }
                endEditing();
            }

            // 保存内容をリセットする
            function resetContent() {
                // カスタム確認ダイアログの代わりにconfirmを使用（デモ用）
                // 本番環境ではカスタムモーダルに置き換えることを推奨
                if (confirm("保存された編集内容をすべてリセットし、ページをリロードします。よろしいですか？")) {
                    try {
                        localStorage.removeItem(storageKey);
                        location.reload();
                    } catch (error) {
                        console.error("Failed to reset content:", error);
                        alert("リセットに失敗しました。");
                    }
                }
            }

            // イベントリスナーを設定
            editButton.addEventListener('click', startEditing);
            saveButton.addEventListener('click', saveContent);
            cancelButton.addEventListener('click', cancelEditing);
            resetButton.addEventListener('click', resetContent);

            // 初期ロード
            loadContent();
        });
    </script>
</body>
</html>
